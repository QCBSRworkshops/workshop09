<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Clustering | Workshop 9: Multivariate Analyses in R</title>
  <meta name="description" content="Multivariate Analyses in R" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Clustering | Workshop 9: Multivariate Analyses in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/qcbsRworkshops/" />
  <meta property="og:image" content="https://github.com/qcbsRworkshops//assets/images/logo/csbq_logo_accueil.png" />
  <meta property="og:description" content="Multivariate Analyses in R" />
  <meta name="github-repo" content="qcbsRworkshops/workshop09" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Clustering | Workshop 9: Multivariate Analyses in R" />
  
  <meta name="twitter:description" content="Multivariate Analyses in R" />
  <meta name="twitter:image" content="https://github.com/qcbsRworkshops//assets/images/logo/csbq_logo_accueil.png" />

<meta name="author" content="Developed and maintained by the contributors of the QCBS R Workshop Series" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="quantifying-data-dissimilarity.html"/>
<link rel="next" href="what-does-unconstrained-mean.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/qcbs-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/images/csbq_logo_gray_accueil.png"></a></li>
<link rel="icon" type="image/png" href="assets/images/favicon.ico"/>

<li class="divider"></li>
<li class="part"><span><b>QCBS R Workshop Series</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i><b>0.1</b> Code of conduct</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#expected-behaviour"><i class="fa fa-check"></i><b>0.1.1</b> Expected behaviour</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#unacceptable-behaviour"><i class="fa fa-check"></i><b>0.1.2</b> Unacceptable behaviour</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>0.2</b> Contributors</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#contributing"><i class="fa fa-check"></i><b>0.3</b> Contributing</a></li>
</ul></li>
<li class="part"><span><b>Multivariate Analyses in <code>R</code></b></span></li>
<li class="chapter" data-level="1" data-path="learning-objectives.html"><a href="learning-objectives.html"><i class="fa fa-check"></i><b>1</b> Learning objectives</a></li>
<li class="chapter" data-level="2" data-path="preparing-for-the-workshop.html"><a href="preparing-for-the-workshop.html"><i class="fa fa-check"></i><b>2</b> Preparing for the workshop</a></li>
<li class="chapter" data-level="3" data-path="what-is-ordination.html"><a href="what-is-ordination.html"><i class="fa fa-check"></i><b>3</b> What is ordination?</a></li>
<li class="chapter" data-level="4" data-path="exploring-the-dataset.html"><a href="exploring-the-dataset.html"><i class="fa fa-check"></i><b>4</b> Exploring the dataset</a><ul>
<li class="chapter" data-level="4.1" data-path="exploring-the-dataset.html"><a href="exploring-the-dataset.html#species-data"><i class="fa fa-check"></i><b>4.1</b> Species data</a></li>
<li class="chapter" data-level="4.2" data-path="exploring-the-dataset.html"><a href="exploring-the-dataset.html#environmental-data"><i class="fa fa-check"></i><b>4.2</b> Environmental data</a></li>
</ul></li>
<li class="part"><span><b>Measures of association</b></span></li>
<li class="chapter" data-level="5" data-path="data-dissimilarity.html"><a href="data-dissimilarity.html"><i class="fa fa-check"></i><b>5</b> Data (dis)similarity</a></li>
<li class="chapter" data-level="6" data-path="quantifying-data-dissimilarity.html"><a href="quantifying-data-dissimilarity.html"><i class="fa fa-check"></i><b>6</b> Quantifying data (dis)similarity</a><ul>
<li class="chapter" data-level="6.1" data-path="quantifying-data-dissimilarity.html"><a href="quantifying-data-dissimilarity.html#transformations-of-community-composition-data"><i class="fa fa-check"></i><b>6.1</b> Transformations of community composition data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>7</b> Clustering</a></li>
<li class="part"><span><b>Unconstrained Ordination</b></span></li>
<li class="chapter" data-level="8" data-path="what-does-unconstrained-mean.html"><a href="what-does-unconstrained-mean.html"><i class="fa fa-check"></i><b>8</b> What does “unconstrained” mean?</a></li>
<li class="chapter" data-level="9" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html"><i class="fa fa-check"></i><b>9</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="10" data-path="correspondence-analysis.html"><a href="correspondence-analysis.html"><i class="fa fa-check"></i><b>10</b> Correspondence Analysis</a></li>
<li class="chapter" data-level="11" data-path="principal-coordinates-analysis.html"><a href="principal-coordinates-analysis.html"><i class="fa fa-check"></i><b>11</b> Principal Coordinates Analysis</a></li>
<li class="chapter" data-level="12" data-path="nonmetric-multidimensional-scaling.html"><a href="nonmetric-multidimensional-scaling.html"><i class="fa fa-check"></i><b>12</b> Nonmetric MultiDimensional Scaling</a></li>
<li class="part"><span><b>Final considerations</b></span></li>
<li class="chapter" data-level="13" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>13</b> Summary</a></li>
<li class="chapter" data-level="14" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i><b>14</b> Additional resources</a></li>
<li class="chapter" data-level="15" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>15</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/qcbsRworkshops" target="blank">QCBS R Workshop Series</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Workshop 9: Multivariate Analyses in <code>R</code></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!------------------------ Hero Image Container --------------------------> 

<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <script src="https://kit.fontawesome.com/6a26f47516.js"></script>
  <script src="assets/qcbs-hideOutput.js"></script>
  <link href="assets/qcbs-style.css" rel="stylesheet">
</head>



<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/images/jean-philippe-delberghe-75xPHEQBmvA-unsplash_hero_image.jpg">
</div>
<div id="clustering" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Clustering</h1>
<p>One application of association matrices is clustering. It is not a
statistical method per se, because it does not test a hypothesis, but it
highlights structures in the data by partitioning either the objects or
the descriptors. As a result, similar objects are combined into groups,
allowing distinctions – or contrasts – between groups to be
identified. One goal of ecologists could be to divide a set of sites
into groups with respect to their environmental conditions or their
community composition.</p>
<p>Clustering results are often represented as dendrograms (trees), where
objects agglomerate into groups. There are several families of
clustering methods, but for the purpose of this workshop, we will
present an overview of three hierarchical agglomerative clustering
methods: single linkage, complete linkage, and Ward’s minimum variance
clustering. See chapter 8 of Legendre and Legendre 2012 for more details
on the different families of clustering methods.</p>
<p>In hierarchical methods, elements of lower clusters (or groups) become
members of larger, higher ranking clusters, e.g. species, genus, family,
order. Prior to clustering, one needs to create an association matrix
among the objects. Distance matrix is the default choice of clustering
functions in R. The association matrix is first sorted in increasing
distance order (or decreasing similarities). Then, groups are formed
hierarchically following rules specific to each method.</p>
<p>Let's take a simple example of a euclidean distance matrix between 5
objets which were sorted in ascending order.</p>
<p><img src="/cluster.example.png" class="align-center" /></p>
<p>In single linkage agglomerative clustering (also called nearest
neighbour sorting), the objects at the closest distances agglomerate.
The two closest objects agglomerate first, the next two closest
objects/clusters are then linked, and so on, which often generates long
thin clusters or chains of objects (see how objets 1 to 5 cluster
successively). Conversely, in complete linkage agglomerative clustering,
an object agglomerates to a group only when linked to the furthest
element of the group, which in turn links it to all members of that
group (in the above example, the group formed of objets 3 and 4 only
clusters with group 1-2 at 0.4, a distance at which objets 1, 2, 3 and 4
are all linked). As a result, complete linkage clustering will form many
small separate groups, and is more appropriate to look for contrasts,
discontinuities in the data.</p>
<p>Let’s compare the single and complete linkage clustering methods using
the Doubs fish species data.</p>
<p>Species data were already Hellinger-transformed. The cluster analysis
requiring similarity or dissimilarity indices, the first step will be to
generate the Hellinger distance indices.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="clustering.html#cb26-1"></a>spe.dhel &lt;-<span class="st"> </span><span class="kw">vegdist</span>(spe.hel, <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)  <span class="co">#generates the distance matrix from Hellinger transformed data</span></span>
<span id="cb26-2"><a href="clustering.html#cb26-2"></a></span>
<span id="cb26-3"><a href="clustering.html#cb26-3"></a><span class="co"># See difference between the two matrices</span></span>
<span id="cb26-4"><a href="clustering.html#cb26-4"></a><span class="kw">head</span>(spe.hel)  <span class="co"># Hellinger-transformed species data</span></span>
<span id="cb26-5"><a href="clustering.html#cb26-5"></a><span class="kw">head</span>(spe.dhel)  <span class="co"># Hellinger distances among sites</span></span></code></pre></div>
<p>Most clustering methods can be computed with the function hclust() of
the stats package.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="clustering.html#cb27-1"></a><span class="co"># Faire le groupement à liens simples Perform single</span></span>
<span id="cb27-2"><a href="clustering.html#cb27-2"></a><span class="co"># linkage clustering</span></span>
<span id="cb27-3"><a href="clustering.html#cb27-3"></a>spe.dhel.single &lt;-<span class="st"> </span><span class="kw">hclust</span>(spe.dhel, <span class="dt">method =</span> <span class="st">&quot;single&quot;</span>)</span>
<span id="cb27-4"><a href="clustering.html#cb27-4"></a><span class="kw">plot</span>(spe.dhel.single)</span>
<span id="cb27-5"><a href="clustering.html#cb27-5"></a></span>
<span id="cb27-6"><a href="clustering.html#cb27-6"></a><span class="co"># Perform complete linkage clustering</span></span>
<span id="cb27-7"><a href="clustering.html#cb27-7"></a>spe.dhel.complete &lt;-<span class="st"> </span><span class="kw">hclust</span>(spe.dhel, <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>)</span>
<span id="cb27-8"><a href="clustering.html#cb27-8"></a><span class="kw">plot</span>(spe.dhel.complete)</span></code></pre></div>
<p><img src="/clust_single.png" class="align-center" /><img src="/clust_complete.png" class="align-center" /></p>
<p>Are there big differences between the two dendrograms?</p>
<p>In single linkage clustering, chains of objets occur (e.g. 19, 29, 30,
20, 26, etc.), whereas more contrasted groups are formed in the complete
linkage clustering.</p>
<p>Ward’s minimum variance clustering differ from these two methods in that
it clusters objects into groups using the criterion of least squares
(similar to linear models). At the beginning, each object is considered
being a cluster of its own. At each step, the pair of clusters merging
is the one leading to minimum increase in total within-group sum of
squares.</p>
<p>Again, it is possible to generate a Ward’s minimum variance clustering
with hclust(). However, the dendogram shows squared distances by
default. In order to compare this dendrogram to the single and complete
linkage clustering results, one must calculate the square root of the
distances.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="clustering.html#cb28-1"></a><span class="co"># Perform Ward minimum variance clustering</span></span>
<span id="cb28-2"><a href="clustering.html#cb28-2"></a>spe.dhel.ward &lt;-<span class="st"> </span><span class="kw">hclust</span>(spe.dhel, <span class="dt">method =</span> <span class="st">&quot;ward.D2&quot;</span>)</span>
<span id="cb28-3"><a href="clustering.html#cb28-3"></a><span class="kw">plot</span>(spe.dhel.ward)</span>
<span id="cb28-4"><a href="clustering.html#cb28-4"></a></span>
<span id="cb28-5"><a href="clustering.html#cb28-5"></a><span class="co"># Re-plot the dendrogram by using the square roots of the</span></span>
<span id="cb28-6"><a href="clustering.html#cb28-6"></a><span class="co"># fusion levels</span></span>
<span id="cb28-7"><a href="clustering.html#cb28-7"></a>spe.dhel.ward<span class="op">$</span>height &lt;-<span class="st"> </span><span class="kw">sqrt</span>(spe.dhel.ward<span class="op">$</span>height)</span>
<span id="cb28-8"><a href="clustering.html#cb28-8"></a><span class="kw">plot</span>(spe.dhel.ward)</span>
<span id="cb28-9"><a href="clustering.html#cb28-9"></a><span class="kw">plot</span>(spe.dhel.ward, <span class="dt">hang =</span> <span class="dv">-1</span>)  <span class="co"># hang=-1 aligns all objets on the same line</span></span></code></pre></div>
<p><img src="/clust_ward.png" class="align-center" />
<img src="/clust_wardfinal.png" class="align-center" /></p>
<p>The clusters generated using Ward’s method tend to be more spherical and
to contain similar numbers of objects.</p>
<p>One must be careful in the choice of an association measure and
clustering method in order to correctly address a problem. What are you
most interested in: gradients? Contrasts? In addition, the results
should be interpreted with respect to the properties of the method used.
If more than one method seems suitable to an ecological question,
computing them all and compare the results would be the way to go. As a
reminder, clustering is not a statistical method, but further steps can
be taken to identify interpretable clusters (e.g. where to cut the
tree), or to compute clustering statistics. Clustering can also be
combined to ordination in order to distinguish groups of sites. These go
beyond the scope of this workshop, but see Borcard et al. 2011 for more
details.</p>

</div>



<hr>
<center> 
  <div class="footer">
      All the content of the workshop series is under a <a href="https://creativecommons.org/licenses/by-nc/2.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="quantifying-data-dissimilarity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="what-does-unconstrained-mean.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
